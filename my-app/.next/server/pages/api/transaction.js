"use strict";(()=>{var e={};e.id=393,e.ids=[393],e.modules={6037:e=>{e.exports=require("mongoose")},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},37:e=>{e.exports=import("uuid")},6762:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,s){return s in t?t[s]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,s)):"function"==typeof t&&"default"===s?t:void 0}}})},3379:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.r(t),s.d(t,{config:()=>c,default:()=>u,routeModule:()=>l});var n=s(9947),r=s(2706),i=s(6762),o=s(139),d=e([o]);o=(d.then?(await d)():d)[0];let u=(0,i.M)(o,"default"),c=(0,i.M)(o,"config"),l=new n.PagesAPIRouteModule({definition:{kind:r.A.PAGES_API,page:"/api/transaction",pathname:"/api/transaction",bundlePath:"",filename:""},userland:o});a()}catch(e){a(e)}})},2065:(e,t,s)=>{s.d(t,{A:()=>r});var a=s(6037),n=s.n(a);let r=async()=>{if(n().connections[0].readyState){console.log("Already connected to MongoDB");return}try{await n().connect(process.env.MONGODB_URI),console.log("MongoDB connected successfully")}catch(e){throw console.error("MongoDB connection error:",e),Error("Failed to connect to MongoDB")}}},5337:(e,t,s)=>{s.d(t,{A:()=>i});var a=s(6037),n=s.n(a);let r=new(n()).Schema({transactionId:{type:String,required:!0,unique:!0},userId:{type:n().Schema.Types.ObjectId,ref:"User",required:!0},type:{type:String,enum:["income","expense"],required:!0},amount:{type:Number,required:!0},description:{type:String,required:!0},date:{type:Date,required:!0}},{timestamps:!0});r.set("toObject",{transform:(e,t)=>{t.id=t.transactionId,delete t._id}});let i=n().models.Transaction||n().model("Transaction",r)},5166:(e,t,s)=>{s.d(t,{A:()=>i});var a=s(6037),n=s.n(a);let r=new(n()).Schema({username:{type:String,required:!0},email:{type:String,required:!0,unique:!0},password:{type:String,required:!0},transactions:[{type:n().Schema.Types.ObjectId,ref:"Transaction"}]},{timestamps:!0}),i=n().models.User||n().model("User",r)},139:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.r(t),s.d(t,{default:()=>c});var n=s(2065),r=s(5337),i=s(5166),o=s(6037),d=s(37),u=e([d]);async function c(e,t){switch(await (0,n.A)(),e.method){case"POST":let{userId:s,type:a,amount:u,description:c,date:l}=e.body;if(!s||!a||!u||!c||!l)return t.status(400).json({message:"Semua field harus diisi"});if(!o.Types.ObjectId.isValid(s))return t.status(400).json({message:"Invalid User ID"});if(isNaN(u)||u<=0)return t.status(400).json({message:"Amount must be a positive number"});let m=new Date(l);if(isNaN(m.getTime()))return t.status(400).json({message:"Invalid date format"});try{let e=(0,d.v4)(),n=new r.A({transactionId:e,userId:new o.Types.ObjectId(s),type:a,amount:u,description:c,date:m});await n.save();let l=await i.A.findById(s);if(!l)return t.status(404).json({message:"User not found"});l.transactions.push(n._id),await l.save(),t.status(201).json(n)}catch(e){console.error("Error creating transaction:",e),t.status(500).json({message:"Terjadi kesalahan saat menambahkan transaksi"})}break;case"GET":t.setHeader("Cache-Control","no-store");let{userId:f,type:p,lastSummary:g}=e.query;if(!f||!o.Types.ObjectId.isValid(f))return t.status(400).json({message:"Invalid or missing userId"});try{if("true"===g){let e=await r.A.find({userId:f}).sort({createdAt:-1}).limit(5);if(0===e.length)return t.status(404).json({message:"No transactions found"});return t.status(200).json(e)}let e={userId:new o.Types.ObjectId(f)};p&&("income"===p||"expense"===p)&&(e.type=p);let s=await r.A.find(e);if(0===s.length)return t.status(404).json({message:"No transactions found"});t.status(200).json(s)}catch(e){console.error("Error fetching transactions:",e),t.status(500).json({message:"Terjadi kesalahan saat mengambil transaksi"})}break;case"DELETE":let{transactionId:y}=e.query;if(!y||void 0===y)return t.status(400).json({message:"Invalid or missing transactionId"});try{let e=await r.A.findOneAndDelete({transactionId:y}),s=await i.A.findOne({transactions:e._id});s&&(s.transactions=s.transactions.filter(t=>!t.equals(e._id)),await s.save()),t.status(200).json({message:"Transaction deleted successfully"})}catch(e){console.error("Error deleting transaction:",e),t.status(500).json({message:"Error deleting transaction"})}break;default:t.setHeader("Allow",["POST","GET","DELETE"]),t.status(405).json({message:`Method ${e.method} Not Allowed`})}}d=(u.then?(await u)():u)[0],a()}catch(e){a(e)}})},2706:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return s}});var s=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},9947:(e,t,s)=>{e.exports=s(5600)}};var t=require("../../webpack-api-runtime.js");t.C(e);var s=t(t.s=3379);module.exports=s})();